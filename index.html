<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="Kissingwolf's Blog" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="任何复杂纷乱的问题都有简单朴实的解决方案">
<meta property="og:type" content="website">
<meta property="og:title" content="Kissingwolf's Blog">
<meta property="og:url" content="http://blog.kissingwolf.com/index.html">
<meta property="og:site_name" content="Kissingwolf's Blog">
<meta property="og:description" content="任何复杂纷乱的问题都有简单朴实的解决方案">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Kissingwolf's Blog">
<meta name="twitter:description" content="任何复杂纷乱的问题都有简单朴实的解决方案">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"always"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://blog.kissingwolf.com/"/>





  <title> Kissingwolf's Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-88598932-1', 'auto');
  ga('send', 'pageview');
</script>









  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Kissingwolf's Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">任何复杂纷乱的问题都有简单朴实的解决方案</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://blog.kissingwolf.com/2017/03/13/虚拟机故障定位过程/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Kevin Zou">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/7866894?v=3&u=9eef3eb744c6f9f1767f02c2c490d607be9cc6eb&s=400">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Kissingwolf's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Kissingwolf's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/13/虚拟机故障定位过程/" itemprop="url">
                  虚拟机故障定位过程
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-13T10:34:03+08:00">
                2017-03-13
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2017/03/13/虚拟机故障定位过程/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/03/13/虚拟机故障定位过程/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近一次虚拟机运行故障，记录一下分析思路和过程。</p>
<p>首先是现象，故障事件描述如下：</p>
<p>2017年3月7日15：40左右，业务报告“虚拟机N”上的服务没有响应了，业务运维发现此KVM虚拟机无法登陆，所有通知基础运维并从新启动了这台KVM虚拟机。</p>
<p>虚拟机重启后业务逐步恢复，需要分析KVM无法登陆的原因。</p>
<p>问题分析过程：</p>
<ol>
<li>首先登陆虚拟机N和其宿主机H，将其上的/var/log/messages日志文件复制到/tmp/message目录下，分析日志内容。</li>
<li>在虚拟机N上的messages文件中发现大量干扰日志，格式类似如下内容</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">2017-03-07 03:28:40.240 info watchdog.lnx[16616]: INFO 2017-03-07 03:28:40 watchdog.go:55 Watchdog Sam<span class="string">'s alive</span></div><div class="line">2017-03-07 03:28:42.240 info watchdog.lnx[16616]: INFO 2017-03-07 03:28:42 watchdog.go:55 Watchdog Sam's alive</div><div class="line">2017-03-07 03:28:44.240 info watchdog.lnx[16616]: INFO 2017-03-07 03:28:44 watchdog.go:55 Watchdog Sam<span class="string">'s alive</span></div><div class="line">2017-03-07 03:28:46.240 info watchdog.lnx[16616]: INFO 2017-03-07 03:28:46 watchdog.go:55 Watchdog Sam's alive</div></pre></td></tr></table></figure>
<p>   所以使用grep将干扰日志项过滤，并显示日志行号方便定位：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># cat -nA messages | grep -v watchdog.go |less</span></div></pre></td></tr></table></figure>
<p>  发现确切的虚拟机故障时间和重启成功时间，相关内容日志如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">18473  2017-03-07 13:30:01.184 info systemd[1]: Removed slice user-0.slice.$</div><div class="line">18474  2017-03-07 13:30:01.184 info systemd[1]: Stopping user-0.slice.$</div><div class="line">18711  ^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@2017-03-07 15:45:26.028 info rsyslogd: [origin software=<span class="string">"rsyslogd"</span> swVersion=<span class="string">"7.4.7"</span> x-pid=<span class="string">"533"</span> x-info=<span class="string">"http://www.rsyslog.com"</span>] start$</div><div class="line">18712  2017-03-07 15:45:25.971 err rsyslogd-2181: <span class="variable">$WorkDirectory</span>: /var/spool/rsyslog can not be accessed, probably does not exist - directive ignored [try http://www.rsyslog.com/e/2181 ]$</div><div class="line">18713  2017-03-07 15:45:26.017 err rsyslogd-2307: warning: ~ action is deprecated, consider using the <span class="string">'stop'</span> statement instead [try http://www.rsyslog.com/e/2307 ]$</div></pre></td></tr></table></figure>
<p>   其中空格分割的第一部分为message文件中条目的原始行号。我们为了快速定位问题时间，使用了过滤干扰项，但分析故障时可能还需要查看原始文件，这个原始行号就十分重要了。</p>
<ol>
<li>在检查日志虚拟机xg-account-vore-srv-10日志时，我们定位到了13：37后此虚拟机出现了故障，然后到15：45我们重新启动了这个虚拟机：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">2017-03-07 13:37:52.240 info watchdog.lnx[16616]: INFO 2017-03-07 13:37:52 watchdog.go:55 Watchdog Sam<span class="string">'s alive</span></div><div class="line">^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@</div><div class="line">^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@</div><div class="line">^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@</div><div class="line">^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@</div><div class="line">^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@^@2017-03-07 15:45:26.028 info rsyslogd: [origin software="rsyslogd" swVersion="7.4.7" x-pid="533" x-info="http://www.rsyslog.com"] start</div><div class="line">2017-03-07 15:45:25.971 err rsyslogd-2181: $WorkDirectory: /var/spool/rsyslog can not be accessed, probably does not exist - directive ignored [try http://www.rsyslog.com/e/2181 ]</div><div class="line">2017-03-07 15:45:26.017 err rsyslogd-2307: warning: ~ action is deprecated, consider using the 'stop<span class="string">' statement instead [try http://www.rsyslog.com/e/2307 ]</span></div></pre></td></tr></table></figure>
<p>   因此，我们需要定位宿主机H上相同时间段，并查看在此时间段内出现和什么故障或报出了什么错误。</p>
<p>   我们在H上的message日志文件中发现了同时段报出的错误日志：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Mar  7 13:38:04 H kernel: EPT: Misconfiguration.</div><div class="line">Mar  7 13:38:04 H kernel: EPT: GPA: 0x108ba4538</div><div class="line">Mar  7 13:38:04 H kernel: ept_misconfig_inspect_spte: spte 0x84c236107 level 4</div><div class="line">Mar  7 13:38:04 H kernel: ept_misconfig_inspect_spte: spte 0x10515c7107 level 3</div><div class="line">Mar  7 13:38:04 H kernel: ept_misconfig_inspect_spte: spte 0xde4657107 level 2</div><div class="line">Mar  7 13:38:04 H kernel: ept_misconfig_inspect_spte: spte 0x1028125d77 level 1</div></pre></td></tr></table></figure>
<p>   其中关键字段和术语：</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>EPT</td>
<td>Extended Page Table</td>
</tr>
<tr>
<td>GPA</td>
<td>Guest Physical address</td>
</tr>
</tbody>
</table>
<p>​    可以看出此错误和KVM虚拟化有关。</p>
<p>​    进一步查看当时的zstack-agent日志：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">2017-03-07 13:38:04,415 DEBUG [vm_plugin] ignore event[Suspended] of the vm[uuid:2c521dfe81b44151b25ff8e4b852fa4e]</div><div class="line">2017-03-07 15:45:08,554 DEBUG [vm_plugin] ignore event[Stopped] <span class="keyword">for</span> the vm[uuid:2c521dfe81b44151b25ff8e4b852fa4e], this operation is from ZStack itself</div></pre></td></tr></table></figure>
<p>   发现有虚拟机挂起！</p>
<ol>
<li>综上，可以断定是由于虚拟机挂起导致的问题。那么为什么会挂起呢？我们借助google可以查找关键字</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kernel: EPT: Misconfiguration.</div></pre></td></tr></table></figure>
<p>可以找到相关的条目，其中有RedHat 知识库中的条目：</p>
<p><a href="https://access.redhat.com/solutions/1758133" target="_blank" rel="external">https://access.redhat.com/solutions/1758133</a></p>
<p>此问题是一个Bug，RedHat知识库描述如下：</p>
<blockquote>
<p>Root Cause</p>
<p>A MMIO Page Fault related bug in KVM causes this. This is a Hypervisor side bug and any VM OS might hit it.</p>
<p>The probability of hitting it appears to be quite low (many VMs running for days).</p>
</blockquote>
<table>
<thead>
<tr>
<th style="text-align:left">字段</th>
<th style="text-align:left">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">MMIO</td>
<td style="text-align:left">Memory-mapped I/O</td>
</tr>
</tbody>
</table>
<p> 这不是一个常见的错误，RedHat 建议升级内核解决这个Bug：</p>
<blockquote>
<p>Resolution</p>
<ul>
<li>RHEL 7.3: Upgrade to <code>kernel-3.10.0-514.el7</code> from <a href="https://rhn.redhat.com/errata/RHSA-2016-2574.html" target="_blank" rel="external">Errata RHSA-2016:2574</a> or later</li>
<li>RHEL 7.2.z: Upgrade to <code>kernel-3.10.0-327.3.1.el7</code> from <a href="https://rhn.redhat.com/errata/RHSA-2015-2552.html" target="_blank" rel="external">Errata RHSA-2015:2552</a> or later</li>
</ul>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://blog.kissingwolf.com/2017/01/12/Python-librbd-创建RBD-image的三种方式/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Kevin Zou">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/7866894?v=3&u=9eef3eb744c6f9f1767f02c2c490d607be9cc6eb&s=400">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Kissingwolf's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Kissingwolf's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/12/Python-librbd-创建RBD-image的三种方式/" itemprop="url">
                  Python librbd 创建RBD image的三种方式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-12T10:47:08+08:00">
                2017-01-12
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2017/01/12/Python-librbd-创建RBD-image的三种方式/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/01/12/Python-librbd-创建RBD-image的三种方式/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="安装python-ceph库"><a href="#安装python-ceph库" class="headerlink" title="安装python-ceph库"></a>安装python-ceph库</h1><p>Ceph官方提供Python库来访问RBD，通过以下命令可以安装。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># yum install python-rbd python-rados -y</div></pre></td></tr></table></figure>
<h1 id="创建-Image"><a href="#创建-Image" class="headerlink" title="创建 Image"></a>创建 Image</h1><p>有三种可选的写法，个人推荐第三种</p>
<h2 id="简单流程"><a href="#简单流程" class="headerlink" title="简单流程"></a>简单流程</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> rados</div><div class="line"><span class="keyword">import</span> rbd</div><div class="line"></div><div class="line">cluster = rados.Rados(conffile=<span class="string">'/etc/ceph/ceph.conf'</span>)</div><div class="line">cluster.connect()</div><div class="line">ioctx = cluster.open_ioctx(<span class="string">'rbd'</span>)</div><div class="line"></div><div class="line">rbd_inst = rbd.RBD()</div><div class="line">size = <span class="number">1024</span>**<span class="number">3</span></div><div class="line">image_name = <span class="string">"test_image"</span></div><div class="line">rbd_inst.create(ioctx, image_name, size)</div><div class="line"></div><div class="line">image = rbd.Image(ioctx, image_name)</div><div class="line">data = <span class="string">'foo'</span> * <span class="number">200</span></div><div class="line">image.write(data, <span class="number">0</span>)</div><div class="line"></div><div class="line">image.close()</div><div class="line">ioctx.close()</div><div class="line">cluster.shutdown()</div></pre></td></tr></table></figure>
<h2 id="Try-Finally-方式"><a href="#Try-Finally-方式" class="headerlink" title="Try-Finally 方式"></a>Try-Finally 方式</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> rados</div><div class="line"><span class="keyword">import</span> rbd</div><div class="line"></div><div class="line">cluster = rados.Rados(conffile=<span class="string">'/etc/ceph/ceph.conf'</span>)</div><div class="line"><span class="keyword">try</span>:</div><div class="line">    ioctx = cluster.open_ioctx(<span class="string">'rbd'</span>)</div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        rbd_inst = rbd.RBD()</div><div class="line">        size = <span class="number">1024</span>**<span class="number">3</span></div><div class="line">    image_name = <span class="string">"test_image"</span></div><div class="line">        rbd_inst.create(ioctx, image_name, size)</div><div class="line">        image = rbd.Image(ioctx, image_name)</div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            data = <span class="string">'foo'</span> * <span class="number">200</span></div><div class="line">            image.write(data, <span class="number">0</span>)</div><div class="line">        <span class="keyword">finally</span>:</div><div class="line">            image.close()</div><div class="line">    <span class="keyword">finally</span>:</div><div class="line">        ioctx.close()</div><div class="line"><span class="keyword">finally</span>:</div><div class="line">    cluster.shutdown()</div></pre></td></tr></table></figure>
<h2 id="With-As-方式"><a href="#With-As-方式" class="headerlink" title="With-As 方式"></a>With-As 方式</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">with</span> rados.Rados(conffile=<span class="string">'/etc/ceph/ceph.conf'</span>) <span class="keyword">as</span> cluster:</div><div class="line">    <span class="keyword">with</span> cluster.open_ioctx(<span class="string">'rbd'</span>) <span class="keyword">as</span> ioctx:</div><div class="line">        rbd_inst = rbd.RBD()</div><div class="line">        size = <span class="number">1024</span>**<span class="number">3</span></div><div class="line">    image_name = <span class="string">"test_image"</span></div><div class="line">        rbd_inst.create(ioctx, image_name, size)</div><div class="line">        <span class="keyword">with</span> rbd.Image(ioctx, image_name) <span class="keyword">as</span> image:</div><div class="line">            data = <span class="string">'foo'</span> * <span class="number">200</span></div><div class="line">            image.write(data, <span class="number">0</span>)</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://blog.kissingwolf.com/2017/01/09/在CentOS7-VPS-上通过Docker-配置科学上网/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Kevin Zou">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/7866894?v=3&u=9eef3eb744c6f9f1767f02c2c490d607be9cc6eb&s=400">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Kissingwolf's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Kissingwolf's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/09/在CentOS7-VPS-上通过Docker-配置科学上网/" itemprop="url">
                  在CentOS7 VPS 上通过Docker 配置科学上网
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-09T15:27:11+08:00">
                2017-01-09
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2017/01/09/在CentOS7-VPS-上通过Docker-配置科学上网/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/01/09/在CentOS7-VPS-上通过Docker-配置科学上网/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>科学上网已经成为天朝 IT 从业人员必备的工作和生活技能。如果你不会就和时代脱节了！</p>
<p>如果你和我一样有自己的VPS，那么你应该自建VPN用来科学上网，这样更加自由！</p>
<p>配置VPN的方法很多，也比较复杂，有没有简单易行的如来神掌呢？当然有！如果你的VPS是Linux系统，并且比较现代，发行版不重要，内核版本很重要！因为我们的如来神掌是基于Docker的，所有你需要3.10以上的内核，然后装上Docker环境。</p>
<p>如何安装和配置Docker ，你可以参看我的文档<a href="https://github.com/kissingwolf/docker-basic" target="_blank" rel="external">docker 基础</a> 。我这里就不重复了。</p>
<p>安装好Docker后，接下来所有的配置和启动都是一个命令和一些参数就可以搞定。你改改密码就好了！</p>
<p>首先记得配好你本地的防火墙和SElinux ，如何你不会，看看<a href="https://github.com/Uplooking-SH/UP100_ule" target="_blank" rel="external">尚观基础课程</a> 。</p>
<p>首先配置pptp vpn ：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">#!/bin/bash</div><div class="line">local_path_to_chap_secrets=./chap-secrets</div><div class="line">docker run -d --privileged --net=host -p 1723:1723 -v \ $&#123;local_path_to_chap_secrets&#125;:/etc/ppp/chap-secrets mobtitude/vpn-pptp</div></pre></td></tr></table></figure>
<p><code>chap-secrets</code>内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kevinzou * ooxx9527FUCKGFW *</div></pre></td></tr></table></figure>
<p>接下来是ipsec vpn：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">#!/bin/bash</div><div class="line">My_PASSWD=&quot;ooxx9527FUCKGFW“</div><div class="line">My_NAME=&quot;kevinzou&quot;</div><div class="line">My_PSK=&quot;F5bF4848B7&quot;</div><div class="line">docker run -d -p 500:500/udp -p 4500:4500/udp -p 1701:1701/udp --privileged --restart=always -e VPN_PASSWORD=$My_PASSWD  -e VPN_USER=$My_NAME -e VPN_PSK=$My_PSK philplckthun/strongswan</div></pre></td></tr></table></figure>
<p>如果pptp和ipsec还满足不了你的需求，可以考虑shadowsocks：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">#!/bin/bash</div><div class="line">SSPASSWORD=&quot;ooxx9527FUCKGFW&quot;</div><div class="line">docker run --restart=always -d -p 12356:1984 oddrationale/docker-shadowsocks -s 0.0.0.0 -p 1984 -k $SSPASSWORD -m aes-256-cfb</div></pre></td></tr></table></figure>
<p>具体参数就不在这里细说了，PPTP方便简单，windows、Linux 和较老的mac都能用。IPSEC 主要是支持ios 10和macOS 10.12。 shadowsocks 支持<code>自动代理模式</code>比较省流量， 并且访问国内也快。</p>
<p>好了，祝玩的开心。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://blog.kissingwolf.com/2017/01/02/练习的心态-如何培养耐心、专注和自律/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Kevin Zou">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/7866894?v=3&u=9eef3eb744c6f9f1767f02c2c490d607be9cc6eb&s=400">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Kissingwolf's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Kissingwolf's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/02/练习的心态-如何培养耐心、专注和自律/" itemprop="url">
                  练习的心态-如何培养耐心、专注和自律
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-02T20:42:39+08:00">
                2017-01-02
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2017/01/02/练习的心态-如何培养耐心、专注和自律/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/01/02/练习的心态-如何培养耐心、专注和自律/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="学习开始"><a href="#学习开始" class="headerlink" title="学习开始"></a>学习开始</h2><blockquote>
<p>实现目标的方法和目标本身同等重要。</p>
<p>人生是一段路程，不是一个目的地。</p>
</blockquote>
<p>人生就是漫长的练习。</p>
<p>所谓练习，就是怀着实现某个特定目标的有意的意识和意图，来反复参加某项活动。</p>
<blockquote>
<p>人生中值得去做的每一件事情，都需要练习。事实上，人生本身只不过是一个漫长的练习过程，是一种永无止境的优化各种行为的努力。当你懂得了练习的正确原理，学习某些新事物的任务将变成一种没有压力的愉快与平和的体验，变成一个适合你生活中各种领域的过程，并且促成你对生活中所有的艰辛与痛苦采用合适的视角来观察。</p>
</blockquote>
<h2 id="以过程为导向，不以结果为导向"><a href="#以过程为导向，不以结果为导向" class="headerlink" title="以过程为导向，不以结果为导向"></a>以过程为导向，不以结果为导向</h2><blockquote>
<p>耐心与自律的问题是，要培养它们其中任何一个，就要同时具备它们两个。</p>
</blockquote>
<p>本着达到某个特定目标的意图，刻意地、反复地参与练习过程。</p>
<ul>
<li>让自己始终以过程为导向。</li>
<li>重点关注当前。</li>
<li>将过程确定为目标，并且运用总目标为船舵，以指引自己的努力。</li>
<li>对自己想要做的事情刻意的训练，带着意图训练，并且自始至终清醒的知道这种意图。</li>
</ul>
<h2 id="关键是视角"><a href="#关键是视角" class="headerlink" title="关键是视角"></a>关键是视角</h2><blockquote>
<p>当我们试图理解自己以及我们对人生中各种努力的痛苦挣扎时，可以通过观察一朵鲜花来找到平和。问你自己：一朵鲜花的生命，从撒下种子到完全盛开，在什么时候刻意达到完美？</p>
</blockquote>
<h2 id="培养期望的习惯"><a href="#培养期望的习惯" class="headerlink" title="培养期望的习惯"></a>培养期望的习惯</h2><blockquote>
<p>习惯是学来的</p>
</blockquote>
<h2 id="感知变化，创造耐心"><a href="#感知变化，创造耐心" class="headerlink" title="感知变化，创造耐心"></a>感知变化，创造耐心</h2><blockquote>
<p>你需要的所有耐心，都已经处在你的内心了。</p>
</blockquote>
<h2 id="4S方法"><a href="#4S方法" class="headerlink" title="4S方法"></a>4S方法</h2><blockquote>
<p>力求简化，将征服大多数复杂的任务。</p>
</blockquote>
<p>简化（simplify）、细分（small）、缩短（short）和放慢（slow）。</p>
<h2 id="平静与DOC方法"><a href="#平静与DOC方法" class="headerlink" title="平静与DOC方法"></a>平静与DOC方法</h2><blockquote>
<p>客观是通往宁静心灵之路。</p>
</blockquote>
<p>“做、观察和纠正（do、observe、correct）</p>
<h2 id="教孩子，也从孩子身上学习"><a href="#教孩子，也从孩子身上学习" class="headerlink" title="教孩子，也从孩子身上学习"></a>教孩子，也从孩子身上学习</h2><blockquote>
<p>智慧并不是年龄的副产品。从你身边所有的人身上学习，同事也用你自己的行动影响身边的人。</p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://blog.kissingwolf.com/2016/12/31/Hexo使用NexT主题时mathjax输入数学公式注意事项/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Kevin Zou">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/7866894?v=3&u=9eef3eb744c6f9f1767f02c2c490d607be9cc6eb&s=400">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Kissingwolf's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Kissingwolf's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/31/Hexo使用NexT主题时mathjax输入数学公式注意事项/" itemprop="url">
                  Hexo使用NexT主题时mathjax输入数学公式注意事项
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-31T17:33:14+08:00">
                2016-12-31
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2016/12/31/Hexo使用NexT主题时mathjax输入数学公式注意事项/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/12/31/Hexo使用NexT主题时mathjax输入数学公式注意事项/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Mathjax号称<code>Beautiful math in all browsers</code>，是展示数学公式方面的好工具。</p>
<h2 id="如何编写Mathjax"><a href="#如何编写Mathjax" class="headerlink" title="如何编写Mathjax"></a>如何编写Mathjax</h2><ul>
<li><a href="http://docs.mathjax.org/en/latest/start.html" target="_blank" rel="external">Mathjax官方文档</a></li>
<li><a href="https://www.codecogs.com/latex/eqneditor.php?lang=zh-cn" target="_blank" rel="external">Mathjax在线生成器</a></li>
<li>在<a href="http://www.typora.io/" target="_blank" rel="external">Typora</a>工具中，使用<code>$$</code>可以编排Mathjax</li>
</ul>
<h2 id="NexT打开Mathjax支持"><a href="#NexT打开Mathjax支持" class="headerlink" title="NexT打开Mathjax支持"></a>NexT打开Mathjax支持</h2><p>默认Hexo的NexT主题是没有打开Mathjax支持的，需要编辑主题的<code>_config.xml</code>文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># MathJax Support</div><div class="line">mathjax:</div><div class="line">  enable: false</div><div class="line">  per_page: false</div><div class="line">  cdn: //cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML</div></pre></td></tr></table></figure>
<p>将<code>enable：false</code>设为<code>enable：true</code>。</p>
<h2 id="复制别人的mathjax代码"><a href="#复制别人的mathjax代码" class="headerlink" title="复制别人的mathjax代码"></a>复制别人的mathjax代码</h2><ul>
<li>查看网页源码。</li>
<li>在公式上右键，<code>Show Math As</code>-&gt;<code>Tex Commande</code></li>
</ul>
<h2 id="重要注意事项"><a href="#重要注意事项" class="headerlink" title="重要注意事项"></a>重要注意事项</h2><ul>
<li>在markdown中使用mathjax下标<code>_</code>时，记得一定要改写成<code>\_</code>，否则将会出现不能解析的情况。</li>
</ul>
<p>状态如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">\overline&#123;x&#125;=\frac&#123;x_&#123;1&#125;+x_&#123;2&#125;…x_&#123;n&#125;&#125;&#123;n&#125;</div></pre></td></tr></table></figure>
<p>$$<br>\overline{x}=\frac{x<em>{1}+x</em>{2}…x_{n}}{n}<br>$$</p>
<p>修改后:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">\overline&#123;x&#125;=\frac&#123;x\_&#123;1&#125;+x\_&#123;2&#125;…x\_&#123;n&#125;&#125;&#123;n&#125;</div></pre></td></tr></table></figure>
<p>$$<br>\overline{x}=\frac{x_{1}+x_{2}…x_{n}}{n}<br>$$</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://blog.kissingwolf.com/2016/12/31/深入浅出学统计-笔记/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Kevin Zou">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/7866894?v=3&u=9eef3eb744c6f9f1767f02c2c490d607be9cc6eb&s=400">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Kissingwolf's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Kissingwolf's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/31/深入浅出学统计-笔记/" itemprop="url">
                  深入浅出学统计-笔记
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-31T12:48:49+08:00">
                2016-12-31
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2016/12/31/深入浅出学统计-笔记/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/12/31/深入浅出学统计-笔记/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="随机抽样"><a href="#随机抽样" class="headerlink" title="随机抽样"></a>随机抽样</h2><blockquote>
<p>随机样本的关键特性是：它作为其来源的总体<code>没有系统性的差别</code></p>
</blockquote>
<p><code>样本</code>是关于特定<code>变量</code>的一个独立观测值集合。当<code>样本</code>由<code>随机</code>采集的观测值组成，且其中每个观测值与其他观测值<code>相互独立</code>时，我们称其为<code>随机样本</code>。</p>
<blockquote>
<p>简单随机样本</p>
</blockquote>
<p>一个大小为n的<code>简单随机样本（SRS）</code>是n个观测值的集合，且抽取方法满足：<code>所有可能从总体抽取的</code>，包含n个观测值的样本都有<code>相等的机会被抽到</code>。</p>
<p>不论是否选择<code>随机抽样技术</code>，都必须<code>确保所得到的样本是总体的代表</code>。否则，随后的一切工作都毫无意义。</p>
<h2 id="样本大小（n）"><a href="#样本大小（n）" class="headerlink" title="样本大小（n）"></a>样本大小（n）</h2><blockquote>
<p>样本大小即单一样本中的测量值的总数。</p>
</blockquote>
<p>一般来说，n越大，我们对统计结论的<code>信心</code>越大，但是样本<code>必须</code>是<code>随机</code>的。</p>
<h2 id="样本平均数"><a href="#样本平均数" class="headerlink" title="样本平均数"></a>样本平均数</h2><p>样本平均数的计算公式，将样本中的所有数值都加起来，然后除以样大小。<br>$$<br>\overline{x}=\frac{x_{1}+x_{2}…x_{n}}{n}<br>$$</p>
<blockquote>
<p><code>中位数</code>是一个样本的“<strong>中间值</strong>”，更适合于在存在<code>偏斜</code>的情况下使用；通过去掉一本分<code>最大值</code>和<code>最小值</code>可以算出<code>去尾平均数</code>，在样本存在<code>极致</code>的情况下啊，这种平均数更适合。</p>
</blockquote>
<h2 id="标准差（s）"><a href="#标准差（s）" class="headerlink" title="标准差（s）"></a>标准差（s）</h2><blockquote>
<p>计算标准差的目的是为了了解与平均值的平均距离。</p>
</blockquote>
<ul>
<li>计算每个测量值与样本平均值之间的距离，我们将这个距离称为<code>偏差</code></li>
<li>求出每个<code>偏差</code>的平方根</li>
<li>将说有<code>偏差</code>的平方根加起来</li>
<li>将说有得到的总数和除以n-1（此处得到结果称之为<code>方差</code>)</li>
<li>求以上结果的平方根</li>
</ul>
<p>$$<br>S=\sqrt{\frac{(x_{1}-\overline{x})^{2}+(x_{2}-\overline{x})^{2}+…(x_{n}-\overline{x})^{2}}{n-1}}<br>$$</p>
<h2 id="分布"><a href="#分布" class="headerlink" title="分布"></a>分布</h2><blockquote>
<p><code>分布</code>描述了一个随机变量的所有可能数值的位置情况。</p>
</blockquote>
<p>如果你用一个总体中的某个变量的所有数值画一张直方图，就会看到该变量的<code>总体分布</code>。</p>
<p>通过<code>分布</code>可以计算特定区域中的随机抽取值的<code>概率（即长期可能性）</code>。</p>
<h2 id="样本统计值与总体参数"><a href="#样本统计值与总体参数" class="headerlink" title="样本统计值与总体参数"></a>样本统计值与总体参数</h2><blockquote>
<p>统计的目的是利用样本对总体进行猜测。</p>
</blockquote>
<p>“X拔”特指<code>样本平均数</code><br>$$<br>\overline{X}<br>$$<br>“S”特指<code>样本标准差</code><br>$$<br>S<br>$$<br>“缪”特指<code>总体平均数</code><br>$$<br>\mu<br>$$<br>“西格玛”特指<code>总体标准差</code><br>$$<br>\sigma<br>$$<br><code>统计值</code>是我们实际测量的数值，因此是确凿无疑的数值。</p>
<p><code>参数</code>是我们想知道的数值，但只能通过猜测获得。</p>
<h2 id="正态分布"><a href="#正态分布" class="headerlink" title="正态分布"></a>正态分布</h2><blockquote>
<p>正态分布代表了平均数的聚集趋势</p>
</blockquote>
<p>我们可以把正态分布分割为不同的区间，用这些区间描述其中的数值的概率。</p>
<h2 id="抽样分布"><a href="#抽样分布" class="headerlink" title="抽样分布"></a>抽样分布</h2><blockquote>
<p>一个抽样分布就是一个样本统计量的分布</p>
</blockquote>
<h2 id="中心极限定理（CLT）"><a href="#中心极限定理（CLT）" class="headerlink" title="中心极限定理（CLT）"></a>中心极限定理（CLT）</h2><blockquote>
<p>当样本大小N很大时，“X拔”的抽样分布接近正态</p>
</blockquote>
<p>N &gt;= 30时此定理成立，所以我们一般认为样本数大于30时为“大样本”。</p>
<h2 id="概率"><a href="#概率" class="headerlink" title="概率"></a>概率</h2><blockquote>
<p>概率是0-1之间的一个数，它对随机事件的发生可能性进行量化，从长期看，概率越接近1，事件越课程发生。</p>
<p>概率仅仅针对于长期性。</p>
</blockquote>
<p>任何概率分布中的总面积都等于1 。</p>
<h2 id="概率数学"><a href="#概率数学" class="headerlink" title="概率数学"></a>概率数学</h2><blockquote>
<p>微积分技术正是用来计算任何分布内的面积。</p>
</blockquote>
<p>正态分布的概率函数：<br>$$<br>f_{\mu ,\sigma }(x)=\frac{1}{\sigma \sqrt{2\pi }}\exp{-\frac{1}{2\sigma ^{2}} (x-\mu )^{2}}<br>$$</p>
<h2 id="置信区间"><a href="#置信区间" class="headerlink" title="置信区间"></a>置信区间</h2><blockquote>
<p>置信区间是与特定置信水平有关的一类区间估计。</p>
</blockquote>
<p>计算总体平均数的95%置信区间的公式：<br>$$<br>\overline{x}\pm 2(\frac{S}{\sqrt{n}})<br>$$<br>通过改变<code>截尾值</code>来改变<code>置信水平</code>，比如1.3作为截尾值可以确定80%的置信区间。</p>
<h2 id="假设检验"><a href="#假设检验" class="headerlink" title="假设检验"></a>假设检验</h2><blockquote>
<p>我们是否认为我们的统计值与原假设所预测的参数具有足够大的偏差，从而可以有理有据拒绝原假设，而选择另一观点。</p>
</blockquote>
<h2 id="P值"><a href="#P值" class="headerlink" title="P值"></a>P值</h2><blockquote>
<p>在原假设为真的前提下，我们将会观测到的数据的极值不超过我们实际观测到的数据的极值得概率。</p>
</blockquote>
<p>P值是对概率的量度，因此只有从长远考虑时才有意义。</p>
<p>在实践中，如果P值“足够小”，即小于0.05，我们就拒绝原假设。小于0.05的概率所表达的意义和“长期结果为每20次不到1次”所表达的意义相当。</p>
<h2 id="我们总有可能是错的"><a href="#我们总有可能是错的" class="headerlink" title="我们总有可能是错的"></a>我们总有可能是错的</h2><blockquote>
<p>我们的统计总有可能是错误的，这一点永远改变不了。我们是在用长期现象评估短期观察结果，这样的事实必然导致这样的结果。</p>
</blockquote>
<p>假设检验无非是提出了这样的一个问题：“我们出于偶然而得到手头这些结果的可能性有多大？” 通过假设检验无法决定性的推翻或证明任何理论；假设检验只能用来帮助我们质疑原假设。</p>
<h2 id="差值推断"><a href="#差值推断" class="headerlink" title="差值推断"></a>差值推断</h2><p>计算两个总体平均数之间的差值的置信区间公式：<br>$$<br>(\overline{x_{1}}-\overline{x_{2}})\pm 2(\sqrt{\frac{S_{1}^{2}-S_{2}^{2}}{n}})<br>$$</p>
<h2 id="小样本推断"><a href="#小样本推断" class="headerlink" title="小样本推断"></a>小样本推断</h2><blockquote>
<p>如果样本很小（小于30），我们不能使用中心极限定理，而应该使用T分布，只有总体本身是正态分布的时候它才有效。</p>
</blockquote>
<p><code>T分布</code>又称之为<code>学生分布</code>。</p>
<h2 id="方差分析"><a href="#方差分析" class="headerlink" title="方差分析"></a>方差分析</h2><blockquote>
<p>方差分析的作用是组间差异和组内差异进行比较。</p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://blog.kissingwolf.com/2016/12/25/关于Windows7中Git-Bash中文乱码问题/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Kevin Zou">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/7866894?v=3&u=9eef3eb744c6f9f1767f02c2c490d607be9cc6eb&s=400">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Kissingwolf's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Kissingwolf's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/25/关于Windows7中Git-Bash中文乱码问题/" itemprop="url">
                  关于Windows7中Git Bash中文乱码问题
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-25T22:45:11+08:00">
                2016-12-25
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2016/12/25/关于Windows7中Git-Bash中文乱码问题/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/12/25/关于Windows7中Git-Bash中文乱码问题/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>今天和同事小龙在其Windows 7 的笔记本电脑上配置GitHub Blog的时候，发现Windows 7 下的Git Bash环境下中文字符显示为乱码，并且无法正常输入中文。</p>
<p>晚上查了一下手册，发现是Windows 7环境下字符编码问题。</p>
<blockquote>
<p>提交时字符编码问题</p>
</blockquote>
<p>打开Git Bash终端，在<code>~</code>目录下修改<code>.gitconfig</code>文件内容，如果没有这个文件就建一个。</p>
<p>添加内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[gui] </div><div class="line">encoding = utf-8 </div><div class="line">[i18n] </div><div class="line">commitencoding = GB2312 #log编码，window 7下默认编码为gb2312,声明后发到GitHub服务器才不会乱码 </div><div class="line">[svn] </div><div class="line">pathnameencoding = GB2312 #支持中文路径</div></pre></td></tr></table></figure>
<blockquote>
<p>显示目录信息时字符编码问题</p>
</blockquote>
<p>在<code>/etc/profile.d/aliases.sh</code>文件中确认如下内容是否存在，如果不存在或是被注释了，请修改：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">alias ls=&apos;ls --show-control-chars --color=auto&apos; #ls能够正常显示中文</div></pre></td></tr></table></figure>
<blockquote>
<p>输入时字符编码问题</p>
</blockquote>
<p>在<code>/etc</code>目录下找到<code>inputrc</code>文件，确认如下两行是否存在，如果不存在请添加，如果被注释请取消注释：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">set output-meta on #可以正常输入中文 </div><div class="line">set convert-meta off</div></pre></td></tr></table></figure>
<p><strong>Windows 10 Git Bash 安装后可以正常显示中文，无需做任何调整</strong></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://blog.kissingwolf.com/2016/12/25/配置macos-的-etc-bashrc/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Kevin Zou">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/7866894?v=3&u=9eef3eb744c6f9f1767f02c2c490d607be9cc6eb&s=400">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Kissingwolf's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Kissingwolf's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/25/配置macos-的-etc-bashrc/" itemprop="url">
                  配置macos 的/etc/bashrc
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-25T00:26:54+08:00">
                2016-12-25
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2016/12/25/配置macos-的-etc-bashrc/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/12/25/配置macos-的-etc-bashrc/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>更新了macos本地的/etc/bashrc，配置了更加醒目的提示符，并且安装了bash-completion，做个备忘。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">kevinzou@KevindeAir ~</div><div class="line"> $ cat /etc/bashrc</div><div class="line">function color_my_prompt &#123;</div><div class="line">    local __user_and_host=&quot;\[\033[01;32m\]\u@\h&quot;</div><div class="line">    local __cur_location=&quot;\[\033[01;34m\]\w&quot;</div><div class="line">    local __git_branch_color=&quot;\[\033[31m\]&quot;</div><div class="line">    #local __git_branch=&quot;\`ruby -e \&quot;print (%x&#123;git branch 2&gt; /dev/null&#125;.grep(/^\*/).first || &apos;&apos;).gsub(/^\* (.+)$/, &apos;(\1) &apos;)\&quot;\`&quot;</div><div class="line">    local __git_branch=&apos;`git branch 2&gt; /dev/null | grep -e ^* | sed -E  s/^\\\\\*\ \(.+\)$/\(\\\\\1\)\ /`&apos;</div><div class="line">    local __prompt_tail=&quot;\n \[\033[35m\]$&quot;</div><div class="line">    local __last_color=&quot;\[\033[00m\]&quot;</div><div class="line">    export PS1=&quot;$__user_and_host $__cur_location $__git_branch_color$__git_branch$__prompt_tail$__last_color &quot;</div><div class="line">&#125;</div><div class="line">color_my_prompt</div><div class="line"></div><div class="line"></div><div class="line">if [ -f $(brew --prefix)/etc/bash_completion ] ; then</div><div class="line">	. $(brew --prefix)/etc/bash_completion</div><div class="line">fi</div></pre></td></tr></table></figure>
<p>在git目录中显示如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">kevinzou@KevindeAir ~/Documents/Github相关/blog.kissingwolf.com (source)</div><div class="line"> $</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://blog.kissingwolf.com/2016/12/23/我的gitconfig配置文件/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Kevin Zou">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/7866894?v=3&u=9eef3eb744c6f9f1767f02c2c490d607be9cc6eb&s=400">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Kissingwolf's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Kissingwolf's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/23/我的gitconfig配置文件/" itemprop="url">
                  我的gitconfig配置文件
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-23T01:12:41+08:00">
                2016-12-23
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2016/12/23/我的gitconfig配置文件/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/12/23/我的gitconfig配置文件/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">$ cat ~/.gitconfig</div><div class="line">[color]</div><div class="line">    ui = auto</div><div class="line">[http]</div><div class="line">[https]</div><div class="line">[user]</div><div class="line">        name = kissingwolf</div><div class="line">        email = kissingwolf@gmail.com</div><div class="line">[color]</div><div class="line">        ui = auto</div><div class="line">[http]</div><div class="line">        proxy = socks5://127.0.0.1:1080</div><div class="line">[https]</div><div class="line">        proxy = socks5://127.0.0.1:1080</div><div class="line">[merge]</div><div class="line">    tool = vimdiff</div><div class="line">[core]</div><div class="line">        autocrlf = false</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://blog.kissingwolf.com/2016/12/12/Docker容器术语及概念总结/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Kevin Zou">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/7866894?v=3&u=9eef3eb744c6f9f1767f02c2c490d607be9cc6eb&s=400">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Kissingwolf's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Kissingwolf's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/12/Docker容器术语及概念总结/" itemprop="url">
                  Docker容器术语及概念总结
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-12T22:56:32+08:00">
                2016-12-12
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2016/12/12/Docker容器术语及概念总结/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/12/12/Docker容器术语及概念总结/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>[TOC]</p>
<h1 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h1><h2 id="镜像和容器"><a href="#镜像和容器" class="headerlink" title="镜像和容器"></a>镜像和容器</h2><ul>
<li>镜像是指文件系统快照或tar包</li>
<li>容器是指镜像的运行态</li>
</ul>
<h2 id="容器与虚拟机"><a href="#容器与虚拟机" class="headerlink" title="容器与虚拟机"></a>容器与虚拟机</h2><ul>
<li>虚拟机持有整个操作系统和应用程序的快照</li>
<li>虚拟机运行着自己的内核</li>
<li>虚拟机可以运行Linux之外的其它操作系统</li>
<li>容器只持有应用程序,但是容器中可以运行多个应用程序设置是真个Linux发行版</li>
<li>容器与宿主机共享内核</li>
<li>容器目前主要运行Linux,Windows的容器还在开放中,容器中的发行版可以选择,容器中的发行版可以和宿主机不同</li>
</ul>
<h2 id="持续集成-持续交付"><a href="#持续集成-持续交付" class="headerlink" title="持续集成/持续交付"></a>持续集成/持续交付</h2><ul>
<li>在应用程序新代码代码提交或出发更新条件时,系统自动构建新镜像并进行部署</li>
</ul>
<h2 id="宿主机管理"><a href="#宿主机管理" class="headerlink" title="宿主机管理"></a>宿主机管理</h2><ul>
<li>部署一台物理机或虚拟机用以运行Docker容器环境</li>
</ul>
<h2 id="编排-编配-Orchestration"><a href="#编排-编配-Orchestration" class="headerlink" title="编排/编配(Orchestration)"></a>编排/编配(Orchestration)</h2><ul>
<li>编配是个控制器进程,用于决定在那里运行容器,以及如何管理容器间的交互</li>
</ul>
<h2 id="调度"><a href="#调度" class="headerlink" title="调度"></a>调度</h2><ul>
<li>用于决定那个容器在那种资源约束下运行在那个宿主机上</li>
</ul>
<h2 id="发现"><a href="#发现" class="headerlink" title="发现"></a>发现</h2><ul>
<li>容器通过公开服务给集群,以及查找其他服务并与之通讯的过程</li>
</ul>
<h2 id="无状态-有状态服务"><a href="#无状态-有状态服务" class="headerlink" title="无状态/有状态服务"></a>无状态/有状态服务</h2><ul>
<li><strong>无状态服务</strong>是指该服务运行的实例不会在本地存储需要持久化的数据，并且多个实例对于同一个请求响应的结果是完全一致的。当该服务对一个请求作出响应之后，不会再有任何相关操作。实现<strong>无状态服务</strong>的高可用，只需要同时运行该服务的多个实例，并保证这些实例的负载均衡即可。</li>
<li><strong>有状态服务</strong>是指该服务的实例可以将一部分数据随时进行备份，并且在创建一个新的有状态服务时，可以通过备份恢复这些数据，以达到数据持久化的目的。同时客户端发送的后续请求依赖于之前相关请求的处理结果。由于单独一项操作可能涉及若干相关请求，有状态服务相对难于管理，只是通过多个实例和负载均衡无法实现高可用。</li>
<li><strong>无状态服务</strong>就好像是农场中的<strong><em>牲口</em></strong>，你不需要提别关注它们其中的某一个，像放牧一样管理他们。<strong>有状态服务</strong>就好像是宠物医院里的<strong><em>宠物猫</em></strong>，你需要记住它们的名字，细心照顾每一个，并且不能把它们混养。</li>
</ul>
<h1 id="容器在企业中业务应用"><a href="#容器在企业中业务应用" class="headerlink" title="容器在企业中业务应用"></a>容器在企业中业务应用</h1><h2 id="企业在实际生产中面对的问题"><a href="#企业在实际生产中面对的问题" class="headerlink" title="企业在实际生产中面对的问题"></a>企业在实际生产中面对的问题</h2><p>随着企业业务的增长和 <strong>微服务化</strong> 的演进，需要迫切解决的问题：</p>
<ul>
<li><p><strong>环境隔离</strong> ：在IDG机房租用的机架物理机时代，由于每个业务依赖的系统环境不同，服务器之间很难通用，服务器负载也各不相同；各个业务由于安全性考量又都需要独立管理服务器资源并处理服务器故障，就对业务开发和变更造成较大负担。</p>
</li>
<li><p><strong>精细资源隔离</strong> ：如果说 <strong>环境隔离</strong> 还可以使用IaaS虚拟机来完成，精细的资源划分和高效的资源利用就需要用容器而非虚拟机了。服务隔离要求按照服务接口对进程物理隔离，防止由于某个接口而影响整体服务，同时也需要根据不同的接口特性设置不同的进程数、CPU计算资源和内存分配容量，实现更加精细且高利用率的资源管理。</p>
</li>
<li><p><strong>资源动态调整</strong> ：企业在部署和调整业务的时候需要服务随之自动适应计算、存储、流量等负载的变化。和虚拟机相比，容器技术更加快捷，在负载高峰期可以更加迅速的增加资源，并保证业务的服务质量；在负载的低峰期可以自动收缩以释放资源给其他服务，以提高集群整体的资源利用率。</p>
<p>​</p>
</li>
</ul>
<h1 id="容器技术介绍"><a href="#容器技术介绍" class="headerlink" title="容器技术介绍"></a>容器技术介绍</h1><h2 id="使用Docker的多种方式"><a href="#使用Docker的多种方式" class="headerlink" title="使用Docker的多种方式"></a>使用Docker的多种方式</h2><ul>
<li>使用镜像为基础的部署方式</li>
<li>安全的在同一台机器上运行多种不同版本的应用</li>
<li>使用一个工具链方便的迁移系统环境到面向服务的架构</li>
<li>发挥云端或裸机的水平扩展和弹性扩展能力</li>
<li>确保开发环境、测试环境和生产环境的一致性</li>
<li>简化公司统一环境一致性及部署成本</li>
</ul>
<h2 id="构建容器环境的流程"><a href="#构建容器环境的流程" class="headerlink" title="构建容器环境的流程"></a>构建容器环境的流程</h2><ol>
<li>构建并保存镜像快照</li>
<li>将镜像上传到仓库中</li>
<li>下载镜像到某台宿主机</li>
<li>以容器方式运行镜像</li>
<li>将容器连接到其他服务上</li>
<li>路由流量到容器中</li>
<li>将容器日志发送到指定位置</li>
<li>监控容器运行状态</li>
</ol>
<h2 id="典型的Docker栈组件"><a href="#典型的Docker栈组件" class="headerlink" title="典型的Docker栈组件"></a>典型的Docker栈组件</h2><ul>
<li>构建系统</li>
<li>镜像仓库系统</li>
<li>配置管理系统</li>
<li>部署系统</li>
<li>编配系统</li>
<li>日志系统</li>
<li>监控系统</li>
</ul>
<h3 id="构建系统"><a href="#构建系统" class="headerlink" title="构建系统"></a>构建系统</h3><p><strong>构建系统</strong>主要解决的是如何生成镜像文件，目前我们是使用Dockerfile来完成镜像构建生成的。<strong>构建系统</strong>需要生成、保存、管理这些Dockerfile编配文件，同时需要管理Dockerfile编配文件的版本。</p>
<p>理想状态下的Docker构建系统使用类似Jenkins的<strong>持续集成系统</strong>，在代码提交时自动通过Dockerfile构建镜像。容器镜像构建成功后，<strong>构建系统</strong>将发送镜像提交给<strong>镜像仓库</strong>。</p>
<h3 id="镜像仓库"><a href="#镜像仓库" class="headerlink" title="镜像仓库"></a>镜像仓库</h3><p><strong>镜像仓库</strong>保存Docker的容器镜像。Docker官方的镜像仓库连接速度慢、安全性不强、稳定性堪忧。企业基本都建立自己的<strong>镜像仓库</strong></p>
<h3 id="配置管理系统"><a href="#配置管理系统" class="headerlink" title="配置管理系统"></a>配置管理系统</h3><p><strong>配置管理系统</strong>定义容器组成集群的方式，定义宿主机资源分配和加密信息保存方式，定义宿主机网络连接方式和容器虚拟网络构架方式。</p>
<h3 id="部署系统"><a href="#部署系统" class="headerlink" title="部署系统"></a>部署系统</h3><p><strong>部署系统</strong>负载将容器推送或拉取到特定的宿主机并使其运行起来。</p>
<ul>
<li>推送 — <strong>部署系统</strong>或<strong>编配系统</strong>将镜像发送到相关宿主机</li>
<li>拉取 — 事先或安全有宿主机从仓库下载镜像</li>
</ul>
<h3 id="编配系统"><a href="#编配系统" class="headerlink" title="编配系统"></a>编配系统</h3><p><strong>编配系统</strong>通过预先编写的编配规则文件，设置容器的运行位置（宿主机），容器可持有资源容量，容器可访问网络地址及端口，容器挂接存储卷方式及位置，容器公开和发现服务的方式。</p>
<h3 id="日志系统"><a href="#日志系统" class="headerlink" title="日志系统"></a>日志系统</h3><p><strong>日志系统</strong>负载汇总宿主机及容器的运行日志，可以通过分析日志得到宿主机和容器及容器中的服务运行过程记录。</p>
<h3 id="监控系统"><a href="#监控系统" class="headerlink" title="监控系统"></a>监控系统</h3><p><strong>监控系统</strong>通过snmp、Agent和<strong>日志系统</strong>提供的信息，通过可视化得方法将宿主机和容器的运行状态、资源使用状态、健康状态呈现出来。</p>
<h2 id="Docker的企业部署优势"><a href="#Docker的企业部署优势" class="headerlink" title="Docker的企业部署优势"></a>Docker的企业部署优势</h2><ul>
<li>Docker可以快速生成和销毁容器，提供了零停机时间部署</li>
<li>Docker为不同的服务版本提供依赖隔离</li>
<li>Docker支持即时回滚</li>
</ul>
<h1 id="安全"><a href="#安全" class="headerlink" title="安全"></a>安全</h1><h2 id="实用先行，安全在后"><a href="#实用先行，安全在后" class="headerlink" title="实用先行，安全在后"></a><strong>实用先行，安全在后</strong></h2><h2 id="威胁模型"><a href="#威胁模型" class="headerlink" title="威胁模型"></a>威胁模型</h2><p>目前<strong>虚拟化</strong>是隔离恶意代码最成熟的技术，而<strong>容器</strong>是隔离延伸的形式，可以作为进一步的层次化保护，进一步减少攻击面。</p>
<p><strong>容器</strong>从根本上是构建在<strong>命名空间</strong>、<strong>cgroup</strong>以及<strong>权能（capability）</strong>之上的。</p>
<p>Linux<strong>容器</strong>的核心是一系列的<strong>命名空间</strong>。一个进程<strong>命名空间</strong>隐藏了所有<strong>命名空间</strong>之外的进程，给用户分配了一组新的进程ID，包括新的init（pid=1）。一个网络<strong>命名空间</strong>隐藏了系统的网络接口，并以新的集合取代原有接口。如果一个项目没有可以引用的名字，就不能与其进行交互，同时生成了隔离。</p>
<h2 id="内核更新"><a href="#内核更新" class="headerlink" title="内核更新"></a>内核更新</h2><p>最直接、基本和有效的方法是及时有效的更新内核和系统补丁。目前除了Oracle和RedHat外没有行之有效的在线更新内核方案，这就意味着更新内核需要重启容器的宿主机，也就会重启宿主机上的所有容器。</p>
<p>生产环境下为了保证性能和可用性，一般配置了容器集群作为服务的运行平台，客户不会想要同时重启集群中的所有容器，这样会造成服务整体下线。一般在这种情况下，容器管理系统应该配置教程重启机制。</p>
<h2 id="容器更新"><a href="#容器更新" class="headerlink" title="容器更新"></a>容器更新</h2><p>容器可按照基础系统分为<strong>胖容器</strong>和<strong>瘦容器</strong>。</p>
<p><strong>胖容器</strong>包含了一个健壮和完整的操作系统，要保存它们的更新非常重要。</p>
<p>Docker容器的自定义性很容易导致开发人员把内容不明的随机容器放置到生产环境中。容器必须从头可重现的构造，如果发现组件中存在安全问题且无法再运行时更新的话，就必须重新构造。</p>
<p><strong>瘦容器</strong>一般构造的是<strong>微服务</strong>环境，<strong>微服务</strong>环境只包含静态链接的二进制文件，如Java、Python、Ruby、Go的生产环境。这样的构造过程就只简单的利用更新后的依赖关系对应用程序进行重新构造。升级的问题就转换为构造时的依赖管理问题。</p>
<h2 id="镜像验证"><a href="#镜像验证" class="headerlink" title="镜像验证"></a>镜像验证</h2><p>Docker1.3引入了Docker<strong>镜像验证</strong>，其目的是追逐镜像构造者和构造完整性，用户具备一组可信的秘钥，包括受信供应商以及用户所在组织的签名，未经签名的镜像则不予运行。</p>
<h2 id="安全的运行Docker守护进程"><a href="#安全的运行Docker守护进程" class="headerlink" title="安全的运行Docker守护进程"></a>安全的运行Docker守护进程</h2><p>Docker守护进程默认只能通过本地Unix套接字访问，保持这个默认配置，不要使用-H参数将Docker守护进程监听帮到TCP端口上实现远程控制。</p>
<h2 id="设备"><a href="#设备" class="headerlink" title="设备"></a>设备</h2><p>容器可以通过–device参数直接访问宿主机的设备，尽量以只读方式共享它们，只提供需要的设备和最新的权限是最佳的策略。</p>
<h2 id="SSH服务"><a href="#SSH服务" class="headerlink" title="SSH服务"></a>SSH服务</h2><p>不要在容器内运行SSH，要系统与在宿主机上管理<strong>容器</strong>。</p>
<p>简化的容器更易于管理，SSH不是必须的，且它还会增加复杂度。</p>
<h1 id="构造镜像"><a href="#构造镜像" class="headerlink" title="构造镜像"></a>构造镜像</h1><p><strong>构造镜像</strong>的方法将决定容器部署的速度、容器日志获取的难度、可配置性和安全程度。</p>
<h2 id="容器镜像-VS-虚拟机镜像"><a href="#容器镜像-VS-虚拟机镜像" class="headerlink" title="容器镜像 VS 虚拟机镜像"></a>容器镜像 VS 虚拟机镜像</h2><p>虚拟机镜像提供了完整的文件系统虚拟化，镜像中的文件系统可以和宿主机文件系统完成不同。通常虚拟机镜像以数据卷的形式实现，以大文件的形式存储在宿主机中。虚拟机系统运行时，用户可以对其进行格式化、分区或修改文件系统。这种方法提供了巨大的隔离性和灵活性，但是性能、效率和成本表现不佳。</p>
<p>容器镜像使用<strong>写时复制（copy-on-write CoW)</strong>技术来提高镜像的安全性和空间的使用效率。在创建和运行多个同一基线数据镜像时，<strong>写时复制</strong>技术可以节省大量时间和空间。每当操作尝试对文件系统进行更改时，实际上是发生在独立的叠加层的，基础镜像保持原封不动。</p>
<h2 id="Docker对写时复制的使用"><a href="#Docker对写时复制的使用" class="headerlink" title="Docker对写时复制的使用"></a>Docker对写时复制的使用</h2><p>Docker使用写时复制将<strong>容器</strong>运行于一个叠加层上，而非直接运行于镜像上。原始镜像是以只读方式使用的，容器所有操作都这是对叠加层的修改。</p>
<p>“<strong>Docker镜像是不可改变的</strong>”，你能做的其实是在它之上构造新的镜像。</p>
<p>Docker叠加层可以跨宿主机共享，每个叠加层都包含了对基础镜像的引用，而基础镜像又是其他镜像的叠加层。</p>
<p>每个叠加层都拥有一个唯一的”ID”，以及一个可选的名称和版本号。</p>
<p>Docker在镜像仓库中索引镜像，并拉取该镜像的所有叠加层的引用，然后确定哪些层已经存在本地，并下载哪些缺失的叠加层。</p>
<h2 id="镜像构造的基本原理"><a href="#镜像构造的基本原理" class="headerlink" title="镜像构造的基本原理"></a>镜像构造的基本原理</h2><p>构造一个镜像可以通过两种方法完成：</p>
<ul>
<li><p>从一个基础镜像启动一个容器，在容器中运行一系列的命令，如安装软件包、编辑配置文件和下载数据等，直到容器处于期望状态，软后对其进行保存。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># docker run -ti centos /bin/bash</span></div><div class="line">root@45678abcd:/<span class="comment"># touch test_foo_file</span></div><div class="line"><span class="comment"># docker commit 45678abcd newimage</span></div><div class="line"><span class="comment"># docker run -ti newimage /bin/bash</span></div></pre></td></tr></table></figure>
<p>这种构造镜像的方法交互且直观，但很难实现<strong>重现</strong>和<strong>自动化</strong>。</p>
</li>
<li><p>另一种方法是使用基于<strong>Dockerfile</strong>文件的方法。在<strong>Dockerfile</strong>文件中包含一系列的指令，Docker在容器中运行这些指令以产生镜像。这些指令分为两组：</p>
<ul>
<li>修改镜像的文件系统<ul>
<li>ADD：将URL指定的远程或本地文件写入镜像文件系统中</li>
<li>RUN：在镜像上执行命令</li>
</ul>
</li>
<li>修改镜像的元数据<ul>
<li>CMD： 设置容器进程运行时的默认命令及其参数</li>
</ul>
</li>
</ul>
<p>使用docker build命令构造基于<strong>Dockerfile</strong>文件的镜像，以<strong>Dockerfile</strong>文件中<strong>FROM</strong>指令指定的基本镜像来启动一个临时容器，然后在这个容器中运行每条指令，Docker为每条指令建立一个中间镜像。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">创建一个保存Dockerfile文件的目录</div><div class="line"><span class="comment"># mkdir myimage</span></div><div class="line"><span class="comment"># cd myimage</span></div><div class="line">创建一个Dockerfile文件</div><div class="line"><span class="comment"># cat &gt;&gt;Dockerfile &lt;&lt;ENDF</span></div><div class="line">FROM centos</div><div class="line">MAINTAINER kissingwolf@gmail.com</div><div class="line">RUN  touch test_foo_file</div><div class="line">ENDF</div><div class="line">接下里可以使用docker build命令构造指定镜像</div><div class="line"><span class="comment"># docker build -t newimage .</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="分层的文件系统和空间接管"><a href="#分层的文件系统和空间接管" class="headerlink" title="分层的文件系统和空间接管"></a>分层的文件系统和空间接管</h3><p>镜像是由一堆文件系统叠加层组成，每一层都是源自前一层的增加、修改和删除。</p>
<ul>
<li>在层里添加文件时，新文件将被创建。</li>
<li>在层里删除文件时，这个文件会被标记为已删除，但是这个文件还包含在上一层中。</li>
<li>在层里修改文件时，根据Docker运行时使用的存储驱动不同，有可能这个文件在新层中被重新创建，也有课程这个文件的部分磁盘扇区在新层中被新磁盘扇区替换。不论哪种方法，旧文件依旧在上一层中保持不变，新层包含新的修改。</li>
</ul>
<p>分层也带来一个问题，镜像无法缩小。随着多次重构镜像，镜像容量会随着层的增加不断增大。对于追求小型化的<strong>微服务</strong>而言，这也是不小的麻烦。</p>
<p>解决空间增长问题的关键是<strong>从小做起</strong>，标准化一个特定的镜像版本，尽可能的将其用于所有容器。</p>
<ul>
<li>BusyBox基础镜像，大约2.5MB，支持运行静态编译二进制文件，且性能良好。</li>
<li>Alpine基础镜像，在BusyBox的基础上构建了apk包管理器，并基于更轻更快的Musl libc。</li>
<li>主流发行版Ubuntu和CentOS，镜像一般在几百兆，提供全功能有技术支持的镜像。</li>
</ul>
<h3 id="保持镜像小巧"><a href="#保持镜像小巧" class="headerlink" title="保持镜像小巧"></a>保持镜像小巧</h3><p>选定一个较小的镜像后，接下来就是在运行Dockerfile之后保持镜像的小巧。</p>
<p>每运行Dockerfile文件中的一个命令，就会生成一个新的镜像层。层一旦生成，其大小就确定下来了，即使后一条Dockerfile指令删除了文件，也不会是否任何空间。</p>
<p>可以像这样在Dockerfile中执行RUN命令,将所有命令放在一个步骤中：<br><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">RUN</span><span class="bash"> curl http://classroom.example.com/foo.tgz -o /tmp/foo.tgz \</span></div><div class="line">&amp;&amp; tar xzf /tmp/foo.tgz -C /usr/<span class="built_in">local</span>/bin \</div><div class="line">&amp;&amp; rm <span class="_">-f</span> /tmp/foo.tgz</div></pre></td></tr></table></figure></p>
<h3 id="让镜像可重用"><a href="#让镜像可重用" class="headerlink" title="让镜像可重用"></a>让镜像可重用</h3><p>两种配置容器中运行进程的方法：</p>
<ul>
<li>通过环境变量将配置传递给容器内部</li>
<li>将配置文件或目录挂接到容器中</li>
</ul>
<p>使用变量或配置文件使镜像重用的好处是，用户可以使用相同的镜像，根据不同的变量或配置灵活的启动容器，完成不同的事物处理。变量和配置可以来自于启动脚本的硬编码或来自于文件，也可以来自于分布式配置服务或是调度器。</p>
<p>使用-e参数传递环境变量的例子：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># docker run  --rm busybox /bin/bash -c 'echo "my variable is $MY_VAR"'</span></div><div class="line">my variable is</div><div class="line">未设置环境变量时，调用为空</div><div class="line"><span class="comment"># docker run  -e "MY_VAR=var_foo" --rm busybox /bin/bash -c 'echo "my variable is $MY_VAR"'</span></div><div class="line">my variable is var_foo</div><div class="line">通过 <span class="_">-e</span> 参数传递了环境变量</div></pre></td></tr></table></figure></p>
<p>使用挂载文件或目录的方式进行配置容器，挂载发生在容器进程启动之前。</p>
<p>使用-v参数挂接宿主机上文件配置容器运行进程的例子：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">首先在宿主机上创建配置文件</div><div class="line"><span class="comment"># cat &gt;&gt;env.conf&lt;&lt;ENDF</span></div><div class="line">Name=kevin</div><div class="line">Mail=kissingwolf@gmail.com</div><div class="line">ENDF</div><div class="line">通过-v参数挂接配置文件到容器，通过容器内部程序调用执行</div><div class="line"><span class="comment"># docker run  -v ./evn.conf:/evn.conf --rm busybox /bin/bash -c 'source /evn.conf ; echo "My Name is $Name , My Email is $Mail"'</span></div></pre></td></tr></table></figure></p>
<h3 id="镜像在Docker变化时对自身进行重新配置"><a href="#镜像在Docker变化时对自身进行重新配置" class="headerlink" title="镜像在Docker变化时对自身进行重新配置"></a>镜像在Docker变化时对自身进行重新配置</h3><p>docker-gen工具在Docker提供的容器信息基础上，使用提供的模板来生成配置文件。</p>
<h3 id="信任与安全"><a href="#信任与安全" class="headerlink" title="信任与安全"></a>信任与安全</h3><p>在使用Docker镜像时，最重要的问题就是镜像是否可信。这个信任来自两个层面：</p>
<ul>
<li>镜像本身是否可信，镜像是否由受信任的开发者编写并提交。</li>
<li>镜像的下载渠道是否可信，下载到的镜像是否是我们想要下载的。</li>
</ul>
<p>目前Docker尚未提高端到端的信任链，要保护自己避免运行包含恶意软件和其他风险的镜像，最好的方法是自主构建镜像。要完整的确认镜像的安全性，用户需要检查所有镜像层,包括基础操作系统镜像层。</p>
<h3 id="保证镜像不可修改"><a href="#保证镜像不可修改" class="headerlink" title="保证镜像不可修改"></a>保证镜像不可修改</h3><p>虽然容器文件系统是可写的，但最好将其视为只读，既不要在容器里保持数据，也不要试图去修改镜像内的文件，仅在容器启动阶段去生成配置文件，所有需要保持的数据要么放在网络存储要么以“<strong>卷</strong>”的方式挂在宿主机上。</p>
<p>将容器文件系统视为只读的原因主要是容器内的文件系统比宿主机的文件系统慢很多，而且容器在销毁后数据记忆丢失。</p>
<p>容器中一个通用的模型是将日志写入容器进程的标准输出，而非写入文件系统。用户依赖Docker自己的日志收集器来提取哪些日志，而不再需要对容器的文件系统进行写入。</p>
<p>如果容器中的服务默认无法将日志输出到标准输出，简单的实现方法是将日志文件链接到标准输出。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">例如Nginx的日志配置</div><div class="line">access_log /var/log/nginx/access_log main；</div><div class="line">我们可以在Dockerfile文件中创建链接文件</div><div class="line">RUN ln -sf 、dev/stdout /var/log/nginx/access_log</div><div class="line">这样容器nginx运行时日志就输出到标准输出了</div></pre></td></tr></table></figure></p>
<h1 id="存储Docker镜像"><a href="#存储Docker镜像" class="headerlink" title="存储Docker镜像"></a>存储Docker镜像</h1><p>存储Docker镜像有三种方式：</p>
<ul>
<li>公共镜像注册仓库服务</li>
<li>私有镜像注册仓库服务</li>
<li>本地保存/载入模式</li>
</ul>
<h2 id="使用公共镜像注册仓库服务存储Docker镜像"><a href="#使用公共镜像注册仓库服务存储Docker镜像" class="headerlink" title="使用公共镜像注册仓库服务存储Docker镜像"></a>使用公共镜像注册仓库服务存储Docker镜像</h2><p>对于普遍的开放环境或是公共用途，使用Docker Hub（hub.docker.com）保存镜像比较方便，Docker Hub就行是Docker的GitHub。使用Docker Hub很方便，注册、登录、推送或拉取镜像。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">将本地只有镜像推送到Docker Hub</div><div class="line"><span class="comment"># docker push -t kissingwolf/busybox</span></div><div class="line">将Docker Hub上的用户镜像拉取到本地</div><div class="line"><span class="comment"># docker pull kissingwolf/busybox</span></div></pre></td></tr></table></figure>
<p>使用公共仓库时，一定要加强使用者安全意识的培养。虽然公共仓库中的镜像也可以设置为私有状态，但是如果镜像中存储了源代码、安全密钥或配置细节（例如用户名和密码），将会带来很严重的安全性问题。</p>
<h2 id="公共仓库自动化构造"><a href="#公共仓库自动化构造" class="headerlink" title="公共仓库自动化构造"></a>公共仓库自动化构造</h2><p>用户可以使用Docker Hub自动构建功能完成镜像的升级或重新构造。将Docker Hub仓库指向一个包含Dockerfile的GitHub仓库或仓库下的路径。设置自动化构建后，每当修改配置源文件（Dockerfile）时，Docker Hub都会自动化的构造新镜像。</p>
<p>自动化构造的优点：</p>
<ul>
<li>减少用户的工作量</li>
<li>安全补丁的自动化更新</li>
<li>以事件驱动的方式更新镜像</li>
</ul>
<h2 id="私有仓库"><a href="#私有仓库" class="headerlink" title="私有仓库"></a>私有仓库</h2><p>私有仓库可以让企业安全的将镜像保存在防火墙或VPN之后，以确保代码和镜像仓库的安全。</p>
<p>建立私有仓库需要考虑 <strong>网络带宽</strong>、<strong>登录凭证</strong>、<strong>SSL安全性</strong>、<strong>监控</strong> 以及 <strong>磁盘存储</strong>等问题。</p>
<p>私有仓库有以下优点：</p>
<ul>
<li>速度–将仓库放在本地网络或自有网络中可以加速镜像的推送和拉取，还可以解决由于GFW导致的访问拒绝问题。</li>
<li>安全性–将仓库放在可控的范围内，并分离内外网，可以做到物理阻隔危险。</li>
</ul>
<h2 id="私有仓库的扩展"><a href="#私有仓库的扩展" class="headerlink" title="私有仓库的扩展"></a>私有仓库的扩展</h2><p>在运行内部私有仓库的时候，建议使用网络存储方式作为仓库镜像存储目录，并根据镜像请求的实际情况做负载均衡以达成冗余。</p>
<p>除了Docker提供的官方Registry服务外，还有其他公司也提供了第三方的Registry扩展服务，例如VMware提供了harbor。</p>
<p><a href="https://github.com/vmware/harbor" target="_blank" rel="external">Harbor</a>是由VMware中国研发团队为企业用户设计的Registry Server开源项目，包括了权限管理(RBAC)、图形管理界面、LDAP/AD集成、审计、自我注册、HA等企业必需的功能，同时针对中国用户的特点，原生支持中文，并计划实现镜像复制(roadmap)等功能。</p>
<h2 id="本地保存-载入"><a href="#本地保存-载入" class="headerlink" title="本地保存/载入"></a>本地保存/载入</h2><p>本地的保持和载入镜像问题是非常常见的需求，并且在没有私有仓库的情况下是绕过GFW的一种简单的方法。</p>
<p>保持/载入的命令方法如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># docker build fooOS</span></div><div class="line"><span class="comment"># docker save fooOS &gt;./fooOS.tar</span></div><div class="line"><span class="comment"># docker load &lt;./fooOS.tar</span></div></pre></td></tr></table></figure>
<p><strong>build</strong> 命令用来根据 <strong>Dockerfile</strong> 创建镜像。<strong>save</strong> 用来保持镜像文件，保持的格式为 <strong>tar</strong> 打包格式。<strong>load</strong> 用来载入 <strong>tar</strong> 打包的镜像文件。</p>
<p>需要注意的是除了 <strong>save/load</strong> 命令之外，Docker还提供了 <strong>export/import</strong> 命令，其主要特点如下：</p>
<ul>
<li><p>与 <strong>save/load</strong> 操作 <strong>镜像</strong> 不同，<strong>export/import</strong> 操作的是 <strong>容器</strong> 。</p>
</li>
<li><p><strong>export/import</strong> 操作因为会丢失历史和元数据，而 <strong>save/loaded</strong> 的镜像没有丢失历史和层，所以 <strong>export/import</strong> 产生的tar包文件体积较 <strong>save/load</strong> 小。</p>
</li>
<li><p><strong>export/import</strong> 无法回滚到之前的层，而 <strong>save/loaded</strong> 持久化整个镜像，可以做到层回滚（可以执行docker tag <layer id=""> <image name="">来回滚之前的层）。</image></layer></p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># docker build fooOS</span></div><div class="line"><span class="comment"># docker export fooOS &gt;./fooOS.tar</span></div><div class="line"><span class="comment"># docker import fooOS:laster &lt;./fooOS.tar</span></div></pre></td></tr></table></figure>
<p>可以通过docker history image_id 命令参看镜像的层结构。</p>
<h2 id="压缩Docker镜像文件体积"><a href="#压缩Docker镜像文件体积" class="headerlink" title="压缩Docker镜像文件体积"></a>压缩Docker镜像文件体积</h2><p>由于用于构建镜像的Linux版本、环境、依赖库和操作不同，Docker镜像的体积可能会越来越大。使用CentOS、RHEL、Ubuntu等发行版作为基础镜像，然后使用RPM、YUM或APT-GET等更新和安装软件包后会遗留一些缓冲文件和依赖项，通过删除和合并镜像层可以减小镜像的文件大小。</p>
<p>CentOS和RHEL作为基础镜像的Docker镜像可以使用goldmann的<a href="https://github.com/goldmann/docker-squash" target="_blank" rel="external">docker-squash</a>工具压缩镜像空间。</p>
<p>Ubuntu作为基础镜像的Docker镜像可以使用jwilder的<a href="https://github.com/jwilder/docker-squash" target="_blank" rel="external">docker-squash</a>工具压缩镜像空间。ki</p>
<h1 id="自动化集成和持续部署（CI-CD）"><a href="#自动化集成和持续部署（CI-CD）" class="headerlink" title="自动化集成和持续部署（CI/CD）"></a>自动化集成和持续部署（CI/CD）</h1><p>Docker构造和推送的方便简单，结合自动化集成和持续部署是目前最强大的DevOps服务部署方式。</p>
<p>Docker本质上是一个应用程序交付框架，Docker的座右铭是：构造、交付与运行。</p>
<p>开发人员期望的是迅速且频繁的交付代码，而企业交付的是产品（打包且经过测试的代码合集），Docker可以将整个产品打包到一个容器中，这不仅仅可以迅速且频繁的打包交付代码，也可以交付已经过测试的产品。</p>
<p>利用Dockerfile结合Gitlab（Github的开源实现）很容易的就可以实现Docker镜像自身的自动化集成和持续部署（CI/CD）。</p>
<h2 id="生产环境下的团队使用Docker标准"><a href="#生产环境下的团队使用Docker标准" class="headerlink" title="生产环境下的团队使用Docker标准"></a>生产环境下的团队使用Docker标准</h2><p>不要让所有人构造并推送容器，如果所有人都随心所欲的选择自己喜欢的基础镜像，并使用自己熟悉的应用服务运行自己编写的代码，最终的结果和无政府主义狂徒构造的社会一样，将是一场结局惨淡的噩梦。</p>
<h3 id="在一个构造系统中构造所有镜像"><a href="#在一个构造系统中构造所有镜像" class="headerlink" title="在一个构造系统中构造所有镜像"></a>在一个构造系统中构造所有镜像</h3><blockquote>
<p>一致性是扩展环境和传播知识的关键。</p>
</blockquote>
<p>应该仔细考虑有关构造、添加、使用和运行Docker容器的标准。规定好基础服务、代码库、依赖库和基础程序编写规范，由统一的提交、审核和发布规则为你的企业产品发布保驾护航。</p>
<p>安全也是构造统一标准的一部分，什么可以放入容器，什么不能放入容器，都要体现在统一标准中。相信你也不希望在容器中保存着你的明文密码或者秘钥吧。</p>
<h3 id="强制使用标准做法"><a href="#强制使用标准做法" class="headerlink" title="强制使用标准做法"></a>强制使用标准做法</h3><p>你和你的团队应该制定统一的标准，例如Web服务是什么、Java使用什么版本等等，细化到如何组织目录结构和环境参数规范。这样可以保证即使你和你的团队在相当长的时候后去调试一个被遗忘的容器或镜像，依旧可以有章可循。越早的强制推行标准会越早的体现它的优势。</p>
<h3 id="使用标准基础镜像"><a href="#使用标准基础镜像" class="headerlink" title="使用标准基础镜像"></a>使用标准基础镜像</h3><p>树立一个规范，让所有镜像继承于一个标准基础镜像，例如Python应用，运维团队创建一个基于Python2.6且有安全保证的基础镜像版本“ uplooking/python_base:2016_07 ”，开放团队仅仅需要使用“FROM”调用这个基础镜像就可以了，然后在构造的时候使用“ADD”将代码添加入镜像，就像这样：<br><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">FROM</span> uplooking/python_base:<span class="number">2016</span>_07</div><div class="line"><span class="keyword">ADD</span><span class="bash"> python_code.py /code.py</span></div><div class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">"python"</span>,<span class="string">"./code.py"</span>]</span></div></pre></td></tr></table></figure></p>
<p>这样可以大大简化镜像的创建过程，将大量的细节交给拥有并维护这个基础镜像的人负责。</p>
<h3 id="使用Dcoker进行集中测试"><a href="#使用Dcoker进行集中测试" class="headerlink" title="使用Dcoker进行集中测试"></a>使用Dcoker进行集中测试</h3><p>用户可以把静态环境转换为一个在测试基础设施中集成Docker镜像的动态环境。Docker可以非常迅速的启动和停止，加上制作优质镜像的简易性，可以根据需要对测试基础设施进行支持，并且很容易的就可以在多个物理机上完成基础测试环境的部署，然后在结束测试后将其关闭。这样不仅部署迅速、环境统一，而且也可以为公司省下保持静态基础设备运行的费用。</p>
<h2 id="配置管理-Configuration-Management-CM"><a href="#配置管理-Configuration-Management-CM" class="headerlink" title="配置管理(Configuration Management,CM)"></a>配置管理(Configuration Management,CM)</h2><p>配置管理工具的目标是完成新上线服务器的配置和现有线上服务配置的更新等任务的标准化和自动化。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="https://avatars0.githubusercontent.com/u/7866894?v=3&u=9eef3eb744c6f9f1767f02c2c490d607be9cc6eb&s=400"
               alt="Kevin Zou" />
          <p class="site-author-name" itemprop="name">Kevin Zou</p>
          <p class="site-description motion-element" itemprop="description">任何复杂纷乱的问题都有简单朴实的解决方案</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">13</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">24</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/kissingwolf" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/kissingwolf" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  Twitter
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/kissingwolf" target="_blank" title="微博">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  微博
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              Links
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://shell909090.org/" title="Shell's Home" target="_blank">Shell's Home</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://booboowei.github.io/" title="BoobooWei Blog" target="_blank">BoobooWei Blog</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.uplooking.com/" title="尚观科技" target="_blank">尚观科技</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Kevin Zou</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"kissingwolf"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  








  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

  


</body>
</html>
